---
phase: 09-seating-chart
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - wedding-platform/src/components/seating/SeatingChart.tsx
  - wedding-platform/src/components/seating/TableCard.tsx
  - wedding-platform/src/components/seating/DraggableGuest.tsx
  - wedding-platform/src/components/seating/UnassignedPool.tsx
  - wedding-platform/src/components/seating/TableForm.tsx
  - wedding-platform/src/app/(platform)/dashboard/seating/page.tsx
autonomous: true

must_haves:
  truths:
    - "Couple can see all tables and unassigned guests"
    - "Couple can drag guests between tables and unassigned pool"
    - "Table shows current/capacity count with plus-ones"
    - "Couple can create, edit, and delete tables"
    - "Full table prevents additional assignments with visual feedback"
  artifacts:
    - path: "wedding-platform/src/components/seating/SeatingChart.tsx"
      provides: "Multi-container dnd-kit context"
      min_lines: 80
    - path: "wedding-platform/src/components/seating/TableCard.tsx"
      provides: "Droppable table container"
      min_lines: 40
    - path: "wedding-platform/src/components/seating/DraggableGuest.tsx"
      provides: "Draggable guest chip"
      min_lines: 30
    - path: "wedding-platform/src/app/(platform)/dashboard/seating/page.tsx"
      provides: "Seating dashboard page"
      min_lines: 50
  key_links:
    - from: "SeatingChart.tsx"
      to: "assignGuestToTable action"
      via: "onDragEnd handler"
      pattern: "assignGuestToTable"
    - from: "TableCard.tsx"
      to: "dnd-kit"
      via: "useDroppable hook"
      pattern: "useDroppable"
---

<objective>
Build the interactive seating chart UI with drag-and-drop guest assignment.

Purpose: Enable couples to visually organize guests into tables using an intuitive interface.
Output: Complete seating management page with table CRUD and drag-drop assignment.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@wedding-platform/.planning/PROJECT.md
@wedding-platform/.planning/ROADMAP.md
@wedding-platform/.planning/STATE.md
@wedding-platform/.planning/phases/09-seating-chart/09-RESEARCH.md
@wedding-platform/.planning/phases/09-seating-chart/09-01-SUMMARY.md

# Existing dnd-kit patterns
@wedding-platform/src/components/content-builder/SortableSectionList.tsx
@wedding-platform/src/components/content-builder/SortableSection.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DraggableGuest and UnassignedPool components</name>
  <files>
wedding-platform/src/components/seating/DraggableGuest.tsx
wedding-platform/src/components/seating/UnassignedPool.tsx
  </files>
  <action>
**DraggableGuest.tsx:**
```typescript
"use client";

import { useDraggable } from "@dnd-kit/core";
import { CSS } from "@dnd-kit/utilities";
import { User } from "lucide-react";
import { cn } from "@/lib/utils"; // or similar utility

interface DraggableGuestProps {
  guest: {
    id: string;
    name: string;
    plusOneCount: number | null;
  };
  containerId: string;
}

export function DraggableGuest({ guest, containerId }: DraggableGuestProps) {
  const { attributes, listeners, setNodeRef, transform, isDragging } = useDraggable({
    id: guest.id,
    data: { containerId, guest },
  });

  const style = {
    transform: CSS.Translate.toString(transform),
  };

  return (
    <div
      ref={setNodeRef}
      style={style}
      {...listeners}
      {...attributes}
      className={cn(
        "inline-flex items-center gap-1 px-2 py-1 bg-white border rounded-full text-sm cursor-grab active:cursor-grabbing select-none",
        isDragging && "opacity-50 shadow-lg ring-2 ring-blue-500"
      )}
    >
      <User className="h-3 w-3 text-gray-400" />
      <span>{guest.name}</span>
      {(guest.plusOneCount ?? 0) > 0 && (
        <span className="text-xs text-gray-500 bg-gray-100 px-1 rounded">+{guest.plusOneCount}</span>
      )}
    </div>
  );
}
```

**UnassignedPool.tsx:**
Create a droppable container using `useDroppable` with id="unassigned".
- Display count of unassigned guests
- Grid or flex layout for guest chips
- Visual feedback when dragging over (isOver state)
- Empty state message when all guests assigned
  </action>
  <verify>
Files compile without TypeScript errors.
Components render in isolation (can import without errors).
  </verify>
  <done>DraggableGuest renders guest chip with plus-one indicator. UnassignedPool is a droppable container for guests without table assignment.</done>
</task>

<task type="auto">
  <name>Task 2: Create TableCard and TableForm components</name>
  <files>
wedding-platform/src/components/seating/TableCard.tsx
wedding-platform/src/components/seating/TableForm.tsx
  </files>
  <action>
**TableCard.tsx:**
Use `useDroppable` hook from @dnd-kit/core.
- Show table name and capacity (e.g., "8/10 seats")
- Calculate headcount: guests.length + sum of plusOneCounts
- Visual states:
  - Normal: border-gray-200
  - Dragging over (not full): border-blue-500 bg-blue-50
  - Dragging over (full): border-red-500 bg-red-50 (prevents drop visually)
- Render DraggableGuest for each assigned guest
- Include edit/delete buttons (icons) in header
- Delete uses confirmation modal pattern (see GuestCard.tsx or EventCard.tsx)

**TableForm.tsx:**
Simple form for creating/editing tables:
- Fields: name (text), capacity (number, min=1)
- Props: onSubmit, initialData (for edit), isSubmitting
- Uses existing form styling patterns
- Modal or inline form based on usage
  </action>
  <verify>
TableCard displays capacity correctly including plus-ones.
TableForm submits with name and capacity fields.
  </verify>
  <done>TableCard is a droppable zone showing assigned guests with capacity indicator. TableForm handles table creation/editing.</done>
</task>

<task type="auto">
  <name>Task 3: Create SeatingChart and dashboard page</name>
  <files>
wedding-platform/src/components/seating/SeatingChart.tsx
wedding-platform/src/app/(platform)/dashboard/seating/page.tsx
  </files>
  <action>
**SeatingChart.tsx:**
Multi-container drag-and-drop using DndContext:

```typescript
"use client";

import { useState, useTransition } from "react";
import {
  DndContext,
  DragEndEvent,
  closestCenter,
  PointerSensor,
  KeyboardSensor,
  useSensor,
  useSensors,
} from "@dnd-kit/core";
import { sortableKeyboardCoordinates } from "@dnd-kit/sortable";
// ... component imports

interface SeatingChartProps {
  tables: TableWithGuests[];
  unassignedGuests: GuestForSeating[];
}
```

Key implementation:
1. Local state for tables and unassigned guests (optimistic updates)
2. Sensors with distance constraint (8px) to allow button clicks
3. `onDragEnd` handler:
   - Extract guestId from active.id
   - Extract source container from active.data.current.containerId
   - Extract destination from over.id (table id or "unassigned")
   - Skip if source === destination
   - Optimistic state update (move guest between containers)
   - Call `assignGuestToTable(guestId, destContainer === "unassigned" ? null : destContainer)`
   - Revert on error
4. Error state display

Layout:
- UnassignedPool at top (full width)
- Tables in responsive grid: `grid-cols-1 md:grid-cols-2 lg:grid-cols-3`
- Add Table button in grid or header

**Dashboard page (page.tsx):**
```typescript
export default async function SeatingPage() {
  const session = await auth();
  if (!session?.user.tenantId) redirect("/dashboard/no-tenant");

  const { tables, unassignedGuests } = await getSeatingData(session.user.tenantId);

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h1 className="text-2xl font-bold">Seating Chart</h1>
        <div className="flex gap-2">
          <Link href="/dashboard/seating/print">Print View</Link>
          {/* Add table button/modal */}
        </div>
      </div>
      <SeatingChart tables={tables} unassignedGuests={unassignedGuests} />
    </div>
  );
}
```

Add helper function `getSeatingData` in actions.ts or page.tsx:
- Query tables with seatAssignments including guest with eventInvitations (for plusOneCount)
- Query unassigned guests: guests without seatAssignment AND with at least one ATTENDING eventInvitation
- Only show RSVP'd (ATTENDING) guests in seating pool
  </action>
  <verify>
`npm run build` succeeds.
Dashboard page at /dashboard/seating loads without errors.
Drag and drop moves guests between containers.
  </verify>
  <done>
SeatingChart implements multi-container drag-drop with optimistic updates.
Dashboard page displays tables and unassigned pool.
Only RSVP'd guests appear in seating interface.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes
2. Navigate to /dashboard/seating - page loads with tables grid and unassigned pool
3. Can drag guest from unassigned to table
4. Can drag guest between tables
5. Can drag guest back to unassigned
6. Full table shows red border when dragging over
7. Can create new table via form
8. Can delete table (guests return to unassigned)
</verification>

<success_criteria>
- SeatingChart renders tables and unassigned guests
- Drag-and-drop works between all containers
- Capacity calculated correctly with plus-ones
- Full tables reject drops with visual feedback
- Table CRUD (create, edit, delete) functional
- Only ATTENDING guests shown in seating interface
</success_criteria>

<output>
After completion, create `.planning/phases/09-seating-chart/09-02-SUMMARY.md`
</output>
