---
phase: 05-rsvp-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - prisma/schema.prisma
  - src/types/prisma-json.d.ts
  - package.json
  - package-lock.json
  - src/lib/email/resend.ts
autonomous: true
user_setup:
  - service: resend
    why: "Email delivery for RSVP reminders"
    env_vars:
      - name: RESEND_API_KEY
        source: "Resend Dashboard -> API Keys -> Create API Key"
    dashboard_config: []

must_haves:
  truths:
    - "Event model has mealOptions JSON field"
    - "MealOption TypeScript type available for type-safe meal operations"
    - "Resend client is configured and ready for email sending"
    - "papaparse is available for CSV generation"
  artifacts:
    - path: "prisma/schema.prisma"
      provides: "Event.mealOptions field"
      contains: "mealOptions"
    - path: "src/types/prisma-json.d.ts"
      provides: "MealOption type declaration"
      contains: "MealOption"
    - path: "src/lib/email/resend.ts"
      provides: "Resend client export"
      exports: ["resend"]
  key_links:
    - from: "src/types/prisma-json.d.ts"
      to: "prisma-json-types-generator"
      via: "PrismaJson namespace"
      pattern: "declare.*PrismaJson"
---

<objective>
Add mealOptions JSON field to Event model and install RSVP system dependencies.

Purpose: The Event model needs per-event meal options for guest meal selection. Supporting packages (Resend for email, papaparse for CSV, React Email for templates) are required for later plans.

Output: Updated Prisma schema with mealOptions, typed MealOption interface, configured Resend client, papaparse available.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@wedding-platform/.planning/PROJECT.md
@wedding-platform/.planning/ROADMAP.md
@wedding-platform/.planning/STATE.md
@wedding-platform/.planning/phases/05-rsvp-system/05-RESEARCH.md

# Existing schema for reference
@wedding-platform/prisma/schema.prisma
@wedding-platform/src/types/prisma-json.d.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mealOptions field to Event model</name>
  <files>prisma/schema.prisma, src/types/prisma-json.d.ts</files>
  <action>
    1. Add to Event model in schema.prisma:
       ```prisma
       /// [MealOption[]]
       mealOptions     Json    @default("[]")
       ```
       Place after `order` field, before `createdAt`.

    2. Update src/types/prisma-json.d.ts to add MealOption type:
       ```typescript
       interface MealOption {
         id: string;
         name: string;
         description?: string;
       }
       ```
       Add inside the PrismaJson namespace alongside existing ThemeSettings.

    3. Run `npx prisma generate` to regenerate client with typed JSON.

    4. Run `npx prisma db push` to sync schema to database.
  </action>
  <verify>
    - `npx prisma validate` passes
    - `npx tsc --noEmit` passes
    - Event type includes mealOptions: PrismaJson.MealOption[]
  </verify>
  <done>Event.mealOptions field exists in schema and TypeScript types are generated</done>
</task>

<task type="auto">
  <name>Task 2: Install RSVP packages and configure Resend</name>
  <files>package.json, src/lib/email/resend.ts</files>
  <action>
    1. Install packages:
       ```bash
       cd wedding-platform && npm install resend @react-email/components papaparse
       npm install -D @types/papaparse
       ```

    2. Create src/lib/email/resend.ts:
       ```typescript
       import { Resend } from "resend";

       if (!process.env.RESEND_API_KEY) {
         console.warn("RESEND_API_KEY not set - email sending will fail");
       }

       export const resend = new Resend(process.env.RESEND_API_KEY);
       ```

    3. Add RESEND_API_KEY to .env.example (not .env - user will configure):
       ```
       # Email (Resend)
       RESEND_API_KEY=re_xxxxxxxxxxxx
       ```
  </action>
  <verify>
    - `npm ls resend` shows resend installed
    - `npm ls papaparse` shows papaparse installed
    - `npm ls @react-email/components` shows react-email installed
    - src/lib/email/resend.ts exports resend client
    - `npx tsc --noEmit` passes
  </verify>
  <done>Resend, papaparse, and React Email packages installed; Resend client configured</done>
</task>

</tasks>

<verification>
- [ ] `npx prisma validate` passes
- [ ] `npx prisma db push` completes without error
- [ ] `npx tsc --noEmit` passes (all types correct)
- [ ] Event model has mealOptions field
- [ ] MealOption type available in PrismaJson namespace
- [ ] resend, papaparse, @react-email/components in package.json dependencies
- [ ] src/lib/email/resend.ts exports resend client
</verification>

<success_criteria>
1. Event.mealOptions JSON field exists with MealOption[] typing
2. All RSVP-related packages (resend, papaparse, @react-email/components) are installed
3. Resend client is exported from src/lib/email/resend.ts
4. TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-rsvp-system/05-01-SUMMARY.md`
</output>
