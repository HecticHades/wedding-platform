---
phase: 03-content-builder
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/app/(platform)/dashboard/theme/page.tsx
  - src/app/(platform)/dashboard/theme/actions.ts
  - src/components/theme/ThemeProvider.tsx
  - src/components/theme/ColorPicker.tsx
  - src/components/theme/FontSelector.tsx
  - src/components/theme/LivePreview.tsx
  - src/app/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Couple can adjust primary, secondary, background, text, and accent colors"
    - "Couple can select body and heading fonts from predefined options"
    - "Changes appear immediately in live preview without page reload"
    - "Saving persists theme settings to database"
  artifacts:
    - path: "src/app/(platform)/dashboard/theme/page.tsx"
      provides: "Theme customization page"
      min_lines: 60
    - path: "src/components/theme/ThemeProvider.tsx"
      provides: "CSS variable injection component"
      exports: ["ThemeProvider"]
    - path: "src/components/theme/ColorPicker.tsx"
      provides: "Color picker using react-colorful"
      min_lines: 20
    - path: "src/components/theme/LivePreview.tsx"
      provides: "Real-time preview of theme changes"
      min_lines: 30
  key_links:
    - from: "src/app/(platform)/dashboard/theme/page.tsx"
      to: "src/components/theme/ColorPicker.tsx"
      via: "component import"
      pattern: "import.*ColorPicker"
    - from: "src/components/theme/ThemeProvider.tsx"
      to: "CSS variables"
      via: "style injection"
      pattern: "--wedding-primary"
---

<objective>
Create the theme customization system where couples can adjust colors and fonts with real-time preview, then save their customizations.

Purpose: While templates provide a starting point, couples want to personalize their wedding site's look. Real-time preview is critical so they can see changes instantly without waiting for saves or page reloads.

Output: Theme editor page with color pickers, font selectors, live preview panel, and save functionality.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@wedding-platform/.planning/PROJECT.md
@wedding-platform/.planning/ROADMAP.md
@wedding-platform/.planning/phases/03-content-builder/03-RESEARCH.md

# From Plan 01
@wedding-platform/src/lib/content/theme-utils.ts
@wedding-platform/src/types/prisma-json.d.ts
@wedding-platform/tailwind.config.ts

# Existing patterns
@wedding-platform/src/app/(platform)/dashboard/page.tsx
@wedding-platform/src/lib/db/prisma.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ThemeProvider and color picker components</name>
  <files>
    - src/components/theme/ThemeProvider.tsx
    - src/components/theme/ColorPicker.tsx
    - src/components/theme/FontSelector.tsx
  </files>
  <action>
Create src/components/theme/ThemeProvider.tsx:
- "use client" directive
- Props: theme (ThemeSettings), children (React.ReactNode)
- Renders a div with inline style containing CSS variables from generateCSSVariables()
- Example: style={{ cssText: generateCSSVariables(theme) } as React.CSSProperties}
- Children render inside this themed div

Create src/components/theme/ColorPicker.tsx:
- "use client" directive
- Props: label (string), value (string), onChange (color: string) => void
- Uses react-colorful's HexColorPicker component
- Shows color preview swatch next to label
- Popover/dropdown pattern: click swatch to open picker
- Includes hex input for direct value entry
- Debounce onChange to avoid excessive updates (100ms)

Create src/components/theme/FontSelector.tsx:
- "use client" directive
- Props: label (string), value (string), onChange (font: string) => void, fonts (string[])
- Dropdown/select with font name options
- Each option shows font name in its actual font (using @next/font or Google Fonts link)
- Use FONT_OPTIONS from theme-utils.ts

FONT_OPTIONS should include:
- Body fonts: Playfair Display, Inter, Merriweather, Lora, Crimson Text, Source Serif Pro
- Heading fonts: Great Vibes, Sacramento, Montserrat, Cormorant Garamond, Pinyon Script, Dancing Script
  </action>
  <verify>
- Components render without error
- ColorPicker shows color picker popup when clicked
- FontSelector shows dropdown with font options
  </verify>
  <done>Theme components created: ThemeProvider for CSS variables, ColorPicker with react-colorful, FontSelector with font options</done>
</task>

<task type="auto">
  <name>Task 2: Create live preview and theme editor page</name>
  <files>
    - src/components/theme/LivePreview.tsx
    - src/app/(platform)/dashboard/theme/page.tsx
    - src/app/(platform)/dashboard/theme/actions.ts
  </files>
  <action>
Create src/components/theme/LivePreview.tsx:
- "use client" directive
- Props: theme (ThemeSettings)
- Renders a mini wedding site preview inside ThemeProvider
- Content:
  - Header with couple names placeholder using font-wedding-heading
  - Wedding date placeholder
  - Sample body text using font-wedding
  - Sample button with bg-wedding-accent
  - Footer area
- Uses Tailwind classes: bg-wedding-background, text-wedding-text, text-wedding-primary, etc.
- Fixed height container with overflow-hidden and scale for compact preview

Create src/app/(platform)/dashboard/theme/actions.ts:
- "use server" directive
- updateTheme(theme: ThemeSettings) server action
- Validates session and tenant context
- Validates theme with Zod schema (all required colors, valid hex format)
- Updates wedding.themeSettings using prisma.wedding.update
- revalidatePath for dashboard pages
- Returns { success: true } or { error: string }

Create src/app/(platform)/dashboard/theme/page.tsx:
- Mixed server/client: Server fetches current theme, client handles editing
- Server part: Load wedding's current themeSettings using withTenantContext
- Client component (ThemeEditor) receives initialTheme as prop
- Client state: useState for current theme values
- Real-time preview: As colors/fonts change in state, LivePreview updates immediately (no server call)
- Save button: useTransition + startTransition to call updateTheme server action
- Show pending state during save
- Layout: 2 columns on lg (editor left, preview right), stacked on mobile
- Color pickers for: Primary, Secondary, Background, Text, Accent
- Font selectors for: Body Font, Heading Font
  </action>
  <verify>
- /dashboard/theme page loads with current theme values
- Changing a color immediately updates the LivePreview (no save required)
- Clicking Save triggers server action and shows loading state
  </verify>
  <done>Theme editor page with live preview, all color pickers, font selectors, and save functionality</done>
</task>

<task type="auto">
  <name>Task 3: Add Google Fonts loading for preview</name>
  <files>
    - src/app/layout.tsx
  </files>
  <action>
Update src/app/layout.tsx to load Google Fonts needed for wedding themes.

Use next/font for self-hosted Google Fonts (better for GDPR compliance and performance):

```typescript
import {
  Playfair_Display,
  Inter,
  Merriweather,
  Great_Vibes,
  Sacramento,
  Montserrat,
  // ... other fonts from FONT_OPTIONS
} from 'next/font/google'
```

Configure each font with variable CSS property:
```typescript
const playfair = Playfair_Display({
  subsets: ['latin'],
  variable: '--font-playfair',
})
```

Apply font variables to html element:
```typescript
<html className={`${playfair.variable} ${inter.variable} ${merriweather.variable} ...`}>
```

Update theme-utils.ts to map font names to CSS variable names:
```typescript
export const FONT_CSS_VAR_MAP: Record<string, string> = {
  'Playfair Display': 'var(--font-playfair)',
  'Inter': 'var(--font-inter)',
  // ...
}
```

Update generateCSSVariables to use the CSS variable map for font values.

This ensures fonts are properly loaded and available for the preview.
  </action>
  <verify>
- Page loads without FOUC (flash of unstyled content)
- Preview shows correct fonts when font selector changes
- Font names display in their actual font in the selector
  </verify>
  <done>Google Fonts loaded via next/font with CSS variables for theme customization</done>
</task>

</tasks>

<verification>
1. /dashboard/theme page loads for logged-in couple
2. Current theme values pre-populate the editors
3. Color picker changes:
   - Open picker for Primary Color
   - Select new color
   - LivePreview immediately shows new primary color
4. Font selector changes:
   - Change Heading Font to "Sacramento"
   - LivePreview heading text shows Sacramento font
5. Save flow:
   - Click Save
   - Loading state appears
   - Success message or page updates
   - Refresh page - changes persist
6. Database verification: wedding.themeSettings contains updated colors
</verification>

<success_criteria>
- Couple can adjust all 5 theme colors using color pickers
- Couple can select body and heading fonts from dropdown
- Changes appear in real-time preview immediately (client-side state)
- Save button persists changes to database
- Page reload shows saved values
- Google Fonts load without layout shift
</success_criteria>

<output>
After completion, create `.planning/phases/03-content-builder/03-03-SUMMARY.md`
</output>
