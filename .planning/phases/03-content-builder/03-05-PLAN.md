---
phase: 03-content-builder
plan: 05
type: execute
wave: 3
depends_on: ["03-04"]
files_modified:
  - src/app/(platform)/dashboard/content/[section]/page.tsx
  - src/app/(platform)/dashboard/content/[section]/actions.ts
  - src/components/content-builder/editors/EventDetailsEditor.tsx
  - src/components/content-builder/editors/OurStoryEditor.tsx
  - src/components/content-builder/editors/TravelEditor.tsx
  - src/components/content-builder/editors/GalleryEditor.tsx
  - src/components/content-builder/editors/TimelineEditor.tsx
  - src/components/content-builder/editors/ContactEditor.tsx
  - src/app/api/upload/route.ts
autonomous: true

must_haves:
  truths:
    - "Couple can edit Event Details section with date, time, venue, dress code"
    - "Couple can edit Our Story section with text content"
    - "Couple can edit Travel section with hotel and direction info"
    - "Couple can edit Gallery section with image uploads"
    - "Couple can edit Timeline section with day-of schedule"
    - "Couple can edit Contact section with contact info"
  artifacts:
    - path: "src/app/(platform)/dashboard/content/[section]/page.tsx"
      provides: "Dynamic section editor page"
      min_lines: 40
    - path: "src/components/content-builder/editors/EventDetailsEditor.tsx"
      provides: "Event details form with multiple events"
      min_lines: 60
    - path: "src/components/content-builder/editors/GalleryEditor.tsx"
      provides: "Gallery editor with image upload"
      min_lines: 50
    - path: "src/app/api/upload/route.ts"
      provides: "Image upload API route for Vercel Blob"
      min_lines: 30
  key_links:
    - from: "src/app/(platform)/dashboard/content/[section]/page.tsx"
      to: "src/components/content-builder/editors/*"
      via: "dynamic component loading"
      pattern: "Editor"
    - from: "src/components/content-builder/editors/GalleryEditor.tsx"
      to: "src/app/api/upload/route.ts"
      via: "fetch POST"
      pattern: "fetch.*api/upload"
---

<objective>
Create individual content editors for all 6 section types: Event Details, Our Story, Travel & Hotels, Photo Gallery, Day-of Timeline, and Contact Info.

Purpose: Each section type has unique content structure. This plan provides tailored editing experiences: date/time pickers for events, rich text for stories, image upload for gallery, etc. Couples can edit each section's content through these specialized forms.

Output: Dynamic section editor route with 6 specialized editor components, plus image upload API for gallery section.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@wedding-platform/.planning/PROJECT.md
@wedding-platform/.planning/ROADMAP.md
@wedding-platform/.planning/phases/03-content-builder/03-RESEARCH.md

# From Plan 01
@wedding-platform/src/types/prisma-json.d.ts
@wedding-platform/src/lib/content/section-types.ts

# From Plan 04
@wedding-platform/src/app/(platform)/dashboard/content/actions.ts

# Existing patterns
@wedding-platform/src/lib/db/prisma.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dynamic section editor page and update action</name>
  <files>
    - src/app/(platform)/dashboard/content/[section]/page.tsx
    - src/app/(platform)/dashboard/content/[section]/actions.ts
  </files>
  <action>
Create src/app/(platform)/dashboard/content/[section]/actions.ts:
- "use server" directive
- updateSectionContent(sectionType: SectionType, content: SectionContent) server action
- Validates session and tenant context
- Validates content matches section type using Zod schema
- Finds section in wedding.contentSections by type
- If not found, returns error
- Updates section's content field
- Updates wedding with modified contentSections array
- revalidatePath("/dashboard/content")
- Returns { success: true } or { error: string }

Create src/app/(platform)/dashboard/content/[section]/page.tsx:
- Dynamic route where [section] is the section type (e.g., "event-details", "our-story")
- Server component that validates section type and fetches section content
- Validates section type is valid SectionType, else notFound()
- Fetches wedding.contentSections using withTenantContext
- Finds section with matching type, else shows "Section not found - add it first"
- Renders appropriate editor component based on section type:
  ```typescript
  const editors: Record<SectionType, React.ComponentType<EditorProps>> = {
    "event-details": EventDetailsEditor,
    "our-story": OurStoryEditor,
    "travel": TravelEditor,
    "gallery": GalleryEditor,
    "timeline": TimelineEditor,
    "contact": ContactEditor,
  }
  ```
- Pass section content as initialContent prop to editor
- Back link to /dashboard/content

EditorProps interface: { initialContent: SectionContent; onSave: (content: SectionContent) => Promise<void> }
  </action>
  <verify>
- /dashboard/content/event-details loads when event-details section exists
- /dashboard/content/invalid-type shows 404
- /dashboard/content/our-story without section shows "add it first" message
  </verify>
  <done>Dynamic section editor route loads correct editor component based on section type</done>
</task>

<task type="auto">
  <name>Task 2: Create Event Details, Our Story, Travel, and Contact editors</name>
  <files>
    - src/components/content-builder/editors/EventDetailsEditor.tsx
    - src/components/content-builder/editors/OurStoryEditor.tsx
    - src/components/content-builder/editors/TravelEditor.tsx
    - src/components/content-builder/editors/ContactEditor.tsx
  </files>
  <action>
Create src/components/content-builder/editors/EventDetailsEditor.tsx:
- "use client"
- Form for EventDetailsContent (array of events)
- Each event has: name, date (date picker), time (time input), location, address, dressCode (optional), description (optional)
- "Add Event" button to add more events (multi-event support for rehearsal, ceremony, reception)
- Remove event button per event
- Save button calls updateSectionContent server action
- Use useTransition for pending state

Create src/components/content-builder/editors/OurStoryEditor.tsx:
- "use client"
- Form for OurStoryContent
- Title input
- Story textarea (rich text optional, start with plain textarea, markdown supported)
- Future: photo array (can leave as placeholder, gallery upload pattern)
- Save button

Create src/components/content-builder/editors/TravelEditor.tsx:
- "use client"
- Form for TravelContent
- Hotels array: each with name, address, phone?, website?, notes?, bookingCode?
- "Add Hotel" button
- Directions textarea
- Airport info textarea
- Save button

Create src/components/content-builder/editors/ContactEditor.tsx:
- "use client"
- Form for ContactContent
- Title input
- Contacts array: each with name, role (Bride, Groom, Wedding Planner, etc.), email?, phone?
- "Add Contact" button
- Message textarea (optional footer message)
- Save button

All editors:
- Initialize state from initialContent prop
- Show loading state during save
- Success/error feedback after save
- Mobile-friendly layout
  </action>
  <verify>
- Each editor renders without error
- Form fields are editable
- Save persists changes to database
- Refresh shows saved values
  </verify>
  <done>Event Details, Our Story, Travel, and Contact section editors complete with forms and save functionality</done>
</task>

<task type="auto">
  <name>Task 3: Create Gallery and Timeline editors with image upload</name>
  <files>
    - src/components/content-builder/editors/GalleryEditor.tsx
    - src/components/content-builder/editors/TimelineEditor.tsx
    - src/app/api/upload/route.ts
  </files>
  <action>
Create src/app/api/upload/route.ts:
- POST handler for image uploads
- Validate session with auth() - must be logged in
- Validate tenantId exists
- Accept multipart/form-data with file field
- Validate file type: image/jpeg, image/png, image/webp, image/gif
- Validate file size: max 4MB (Vercel Function limit)
- Upload to Vercel Blob with tenant-prefixed path: `${tenantId}/gallery/${timestamp}-${filename}`
- Use { access: "public" } for public access
- Return { url: blob.url }
- Handle errors with appropriate status codes

Create src/components/content-builder/editors/GalleryEditor.tsx:
- "use client"
- Form for GalleryContent
- Title input
- Photo grid display with existing photos
- Upload button/dropzone for new photos:
  - Input type="file" multiple accept="image/*"
  - On file select, POST to /api/upload
  - Show upload progress/loading per image
  - On success, add photo object { url, caption: "", order: photos.length } to state
- Each photo shows:
  - Thumbnail preview
  - Caption input
  - Delete button
- Drag-and-drop reorder for photos (optional: can use simple move up/down buttons as simpler alternative)
- Save button saves photo array (URLs, captions, order)

Create src/components/content-builder/editors/TimelineEditor.tsx:
- "use client"
- Form for TimelineContent
- Title input (e.g., "Wedding Day Schedule")
- Events array: each with time (time input), title, description?
- "Add Event" button
- Reorder events (move up/down buttons)
- Remove event button
- Save button

Both editors follow same patterns as Task 2 editors.
  </action>
  <verify>
- /api/upload accepts image and returns URL
- GalleryEditor: Upload image -> appears in grid -> Save -> Refresh -> Image persists
- TimelineEditor: Add events with times -> Save -> Refresh -> Events persist
- Image URLs are Vercel Blob URLs (*.public.blob.vercel-storage.com)
  </verify>
  <done>Gallery editor with image upload to Vercel Blob and Timeline editor complete</done>
</task>

</tasks>

<verification>
1. Event Details editor:
   - Navigate from /dashboard/content click Edit on Event Details
   - Add event with name "Ceremony", date, time, location
   - Save -> Refresh -> Event persists

2. Our Story editor:
   - Add story title and text
   - Save -> Refresh -> Content persists

3. Travel editor:
   - Add hotel with name, address, booking code
   - Add directions text
   - Save -> Refresh -> Content persists

4. Gallery editor:
   - Upload 2 images
   - Both show in grid with Vercel Blob URLs
   - Add captions
   - Save -> Refresh -> Images and captions persist

5. Timeline editor:
   - Add 3 schedule events (4:00 PM Ceremony, 5:00 PM Cocktails, 6:00 PM Reception)
   - Save -> Refresh -> Events persist in order

6. Contact editor:
   - Add bride and groom contacts with emails
   - Save -> Refresh -> Contacts persist
</verification>

<success_criteria>
- All 6 section types have working editors accessible from /dashboard/content/[type]
- Event Details: Multiple events with date/time/location
- Our Story: Title and story text
- Travel: Hotels array and directions
- Gallery: Image upload to Vercel Blob, captions
- Timeline: Time-based schedule events
- Contact: Contacts array with roles and contact info
- All editors save content to database
- Content persists across page refreshes
</success_criteria>

<output>
After completion, create `.planning/phases/03-content-builder/03-05-SUMMARY.md`
</output>
