---
phase: 03-content-builder
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - prisma/schema.prisma
  - src/types/prisma-json.d.ts
  - src/lib/content/section-types.ts
  - src/lib/content/theme-utils.ts
  - tailwind.config.ts
  - package.json
autonomous: true
user_setup:
  - service: vercel-blob
    why: "Image storage for gallery section"
    env_vars:
      - name: BLOB_READ_WRITE_TOKEN
        source: "Vercel Dashboard -> Project -> Storage -> Create Blob Store -> Generate Token"

must_haves:
  truths:
    - "Wedding model has templateId, themeSettings, and contentSections fields"
    - "TypeScript types define all 6 content section structures"
    - "CSS variable theme colors are configurable in Tailwind"
    - "Required packages are installed and available"
  artifacts:
    - path: "prisma/schema.prisma"
      provides: "Wedding model with theme and content fields"
      contains: "themeSettings"
    - path: "src/types/prisma-json.d.ts"
      provides: "Type definitions for JSON fields"
      contains: "ContentSection"
    - path: "src/lib/content/section-types.ts"
      provides: "Section type constants and validation"
      exports: ["SECTION_TYPES", "sectionSchema"]
    - path: "src/lib/content/theme-utils.ts"
      provides: "CSS variable generation utilities"
      exports: ["generateCSSVariables", "ThemeSettings"]
    - path: "tailwind.config.ts"
      provides: "Wedding theme color and font configuration"
      contains: "wedding-primary"
  key_links:
    - from: "prisma/schema.prisma"
      to: "src/types/prisma-json.d.ts"
      via: "JSON type annotations"
      pattern: "/// \\[ThemeSettings\\]"
---

<objective>
Set up the foundation for content builder: Prisma schema updates, TypeScript types for content sections and themes, Tailwind CSS variable configuration, and install required packages.

Purpose: All subsequent plans (templates, themes, content sections) depend on these types and schema fields existing. This plan establishes the data model and type system.

Output: Updated Prisma schema with theme/content fields, TypeScript types for all section types, Tailwind configured with CSS variables for runtime theming.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@wedding-platform/.planning/PROJECT.md
@wedding-platform/.planning/ROADMAP.md
@wedding-platform/.planning/STATE.md
@wedding-platform/.planning/phases/03-content-builder/03-RESEARCH.md

# Key existing files
@wedding-platform/prisma/schema.prisma
@wedding-platform/tailwind.config.ts
@wedding-platform/src/lib/db/prisma.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install packages and update Prisma schema</name>
  <files>
    - package.json
    - prisma/schema.prisma
  </files>
  <action>
Install required packages:
```bash
npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities @vercel/blob react-colorful
npm install -D prisma-json-types-generator
```

Add JSON types generator to prisma/schema.prisma:
```prisma
generator jsonTypes {
  provider = "prisma-json-types-generator"
}
```

Update the Wedding model to add:
- `templateId String @default("classic")` - Selected template ID
- `themeSettings Json @default("{}")` - Theme customization with comment `/// [ThemeSettings]`
- `contentSections Json @default("[]")` - Content sections array with comment `/// [ContentSection[]]`

Run `npx prisma generate` to regenerate client with JSON types.
Run `npx prisma db push` to update database schema.
  </action>
  <verify>
- `npm ls @dnd-kit/core @vercel/blob react-colorful` shows packages installed
- `npx prisma validate` passes
- `npx prisma generate` completes without errors
  </verify>
  <done>Packages installed, Prisma schema has templateId, themeSettings, and contentSections fields on Wedding model</done>
</task>

<task type="auto">
  <name>Task 2: Create TypeScript types for JSON fields</name>
  <files>
    - src/types/prisma-json.d.ts
    - src/lib/content/section-types.ts
    - src/lib/content/theme-utils.ts
  </files>
  <action>
Create src/types/prisma-json.d.ts with PrismaJson namespace containing:
- `ThemeSettings` interface with: primaryColor, secondaryColor, backgroundColor, textColor, accentColor, fontFamily, headingFont (all strings)
- `SectionType` union: "event-details" | "our-story" | "travel" | "gallery" | "timeline" | "contact"
- `ContentSection` interface with: id (string), type (SectionType), order (number), isVisible (boolean), content (SectionContent)
- Individual content type interfaces for each section:
  - `EventDetailsContent`: events array with name, date, time, location, address, dressCode?, description?
  - `OurStoryContent`: title, story (markdown/text), photos? (string[])
  - `OurStoryContent`: title, story (markdown/text), photos? (string[])
  - `TravelContent`: hotels array, directions?, airportInfo?
  - `GalleryContent`: title, photos array with url, caption?, order
  - `TimelineContent`: title, events array with time, title, description?
  - `ContactContent`: title, contacts array with name, role, email?, phone?, message?
- `SectionContent` union type of all content types

Create src/lib/content/section-types.ts with:
- SECTION_TYPES constant array with metadata for each type (id, label, icon name, description)
- Zod schemas for validating each section content type
- Helper functions: createEmptySection(type), getSectionLabel(type)

Create src/lib/content/theme-utils.ts with:
- ThemeSettings type re-export
- DEFAULT_THEME constant with sensible defaults
- generateCSSVariables(theme: ThemeSettings): string function that outputs CSS variable declarations
- FONT_OPTIONS array with common wedding fonts (Google Fonts names)
  </action>
  <verify>
- `npx tsc --noEmit` passes without type errors
- Importing types works: `import type { ThemeSettings, ContentSection } from '@/types/prisma-json'`
  </verify>
  <done>TypeScript types define all content section structures and theme settings, with Zod validation schemas</done>
</task>

<task type="auto">
  <name>Task 3: Configure Tailwind for CSS variable theming</name>
  <files>
    - tailwind.config.ts
  </files>
  <action>
Update tailwind.config.ts to extend theme with CSS variable-based colors:
```typescript
theme: {
  extend: {
    colors: {
      background: "var(--background)",
      foreground: "var(--foreground)",
      wedding: {
        primary: "var(--wedding-primary)",
        secondary: "var(--wedding-secondary)",
        background: "var(--wedding-background)",
        text: "var(--wedding-text)",
        accent: "var(--wedding-accent)",
      },
    },
    fontFamily: {
      wedding: ["var(--wedding-font-body)", "serif"],
      "wedding-heading": ["var(--wedding-font-heading)", "cursive"],
    },
  },
},
```

This allows using Tailwind classes like `bg-wedding-primary`, `text-wedding-text`, `font-wedding-heading` that read from CSS variables set at runtime.
  </action>
  <verify>
- `npm run build` completes without Tailwind errors
- Tailwind classes like `bg-wedding-primary` are recognized in IDE
  </verify>
  <done>Tailwind configured with wedding theme colors and fonts that use CSS variables for runtime switching</done>
</task>

</tasks>

<verification>
1. `npm ls @dnd-kit/core @dnd-kit/sortable @vercel/blob react-colorful` shows all packages
2. `npx prisma validate` passes
3. `npx tsc --noEmit` passes
4. `npm run build` succeeds
5. Wedding model in Prisma has templateId, themeSettings, contentSections fields
</verification>

<success_criteria>
- Wedding model extended with templateId, themeSettings (JSON), contentSections (JSON)
- TypeScript types exist for ThemeSettings and all 6 ContentSection types
- Zod validation schemas exist for content validation
- Tailwind extended with wedding-* colors and fonts using CSS variables
- All packages installed: @dnd-kit/core, @dnd-kit/sortable, @vercel/blob, react-colorful
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-content-builder/03-01-SUMMARY.md`
</output>
