---
phase: 04-event-guest-management
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/app/(platform)/dashboard/events/page.tsx
  - src/app/(platform)/dashboard/events/new/page.tsx
  - src/app/(platform)/dashboard/events/[id]/page.tsx
  - src/app/(platform)/dashboard/events/actions.ts
  - src/components/events/EventList.tsx
  - src/components/events/EventForm.tsx
  - src/components/events/EventCard.tsx
autonomous: true

must_haves:
  truths:
    - "Couple can view list of all events for their wedding"
    - "Couple can create a new event with name, date/time, location, and visibility settings"
    - "Couple can edit existing event details"
    - "Couple can delete an event"
    - "Events display in chronological order"
  artifacts:
    - path: "src/app/(platform)/dashboard/events/page.tsx"
      provides: "Event list page with add button"
      min_lines: 30
    - path: "src/app/(platform)/dashboard/events/actions.ts"
      provides: "createEvent, updateEvent, deleteEvent, reorderEvents server actions"
      exports: ["createEvent", "updateEvent", "deleteEvent"]
    - path: "src/components/events/EventForm.tsx"
      provides: "Event creation/editing form component"
      min_lines: 80
  key_links:
    - from: "src/app/(platform)/dashboard/events/page.tsx"
      to: "prisma.event.findMany"
      via: "withTenantContext query"
      pattern: "prisma\\.event\\."
    - from: "src/components/events/EventForm.tsx"
      to: "src/app/(platform)/dashboard/events/actions.ts"
      via: "form action submission"
      pattern: "createEvent|updateEvent"
---

<objective>
Build the event management UI for couples to create and manage wedding events.

Purpose: Enable couples to define multiple events (ceremony, reception, rehearsal dinner) with distinct details.
Output: Event list page, event form, server actions for event CRUD.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@wedding-platform/.planning/PROJECT.md
@wedding-platform/.planning/ROADMAP.md
@wedding-platform/.planning/STATE.md
@wedding-platform/.planning/phases/04-event-guest-management/04-RESEARCH.md

@wedding-platform/src/app/(platform)/dashboard/content/actions.ts
@wedding-platform/src/app/(platform)/dashboard/content/page.tsx
@wedding-platform/src/lib/auth/auth.ts
@wedding-platform/src/lib/db/prisma.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create event server actions</name>
  <files>src/app/(platform)/dashboard/events/actions.ts</files>
  <action>
Create server actions for event CRUD operations following the established pattern from content/actions.ts:

**createEvent(formData: FormData)**
- Auth check with session.user.tenantId
- Zod validation schema:
  - name: string (required, min 1 char)
  - description: string (optional)
  - dateTime: string (required, ISO datetime)
  - endTime: string (optional, ISO datetime)
  - location: string (optional)
  - address: string (optional)
  - dressCode: string (optional)
  - isPublic: boolean (default true)
- Use withTenantContext to get wedding.id
- Create event with prisma.event.create
- Calculate order as max(existing orders) + 1
- revalidatePath("/dashboard/events")
- Return { success: true, eventId } or { success: false, error }

**updateEvent(eventId: string, formData: FormData)**
- Same validation as createEvent
- Use withTenantContext
- Update event with prisma.event.update
- revalidatePath for both list and detail page

**deleteEvent(eventId: string)**
- Auth check
- withTenantContext
- Delete with prisma.event.delete (cascades to EventGuest)
- revalidatePath

**reorderEvents(orderedEvents: { id: string; order: number }[])**
- Auth check
- Validate array of {id, order} objects
- Update each event's order field
- revalidatePath

Use "use server" directive. Handle errors gracefully with try/catch.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit` in wedding-platform directory</verify>
  <done>All four event server actions implemented with proper tenant isolation and validation</done>
</task>

<task type="auto">
  <name>Task 2: Create event components</name>
  <files>
    src/components/events/EventList.tsx
    src/components/events/EventCard.tsx
    src/components/events/EventForm.tsx
  </files>
  <action>
Create three components for event management:

**EventCard.tsx** (client component):
- Props: event object, onEdit callback, onDelete callback
- Display: event name, formatted date/time, location, visibility badge
- Actions: Edit button, Delete button with confirmation
- Visual indicator for public vs invite-only events
- Use lucide-react icons (Calendar, MapPin, Clock, Users, Lock)

**EventList.tsx** (client component):
- Props: events array
- Display events in a vertical list using EventCard
- Empty state: "No events yet. Create your first event to get started."
- Header with event count
- Link to create new event
- Client-side search/filter by name (optional but nice)

**EventForm.tsx** (client component):
- Props: optional event object (for editing), optional onSuccess callback
- Fields:
  - Event Name (required input)
  - Start Date & Time (datetime-local input, required)
  - End Time (datetime-local input, optional)
  - Venue Name (text input)
  - Address (text input)
  - Dress Code (text input)
  - Description (textarea)
  - Public checkbox (visible to all guests vs invite-only)
- Submit button: "Create Event" or "Save Changes"
- Cancel button that navigates back
- Use useTransition for pending state
- Format dates for datetime-local inputs

Follow the styling patterns from existing components (Tailwind, rounded-lg, shadow, etc).
  </action>
  <verify>Components render without errors in Storybook or dev server</verify>
  <done>EventCard, EventList, and EventForm components created with consistent styling</done>
</task>

<task type="auto">
  <name>Task 3: Create event management pages</name>
  <files>
    src/app/(platform)/dashboard/events/page.tsx
    src/app/(platform)/dashboard/events/new/page.tsx
    src/app/(platform)/dashboard/events/[id]/page.tsx
  </files>
  <action>
Create the event management pages:

**events/page.tsx** (server component):
- Auth check, redirect if no session or tenantId
- Fetch events with withTenantContext and prisma.event.findMany
- Order by dateTime ascending (chronological)
- Render EventList component with fetched events
- Include "Add Event" button linking to /dashboard/events/new

**events/new/page.tsx** (server component):
- Auth check
- Render EventForm component in create mode (no event prop)
- Page title: "Create Event"
- Breadcrumb: Dashboard > Events > New

**events/[id]/page.tsx** (server component):
- Auth check
- Fetch single event with withTenantContext and prisma.event.findFirst({ where: { id: params.id } })
- If not found, redirect to /dashboard/events or show 404
- Render EventForm component with event prop for editing
- Page title: "Edit Event"
- Breadcrumb: Dashboard > Events > [Event Name]

Follow the page structure patterns from dashboard/content/page.tsx and dashboard/templates/page.tsx.
  </action>
  <verify>Pages load without errors: navigate to /dashboard/events in browser</verify>
  <done>Event list, create, and edit pages render correctly with proper routing</done>
</task>

</tasks>

<verification>
1. Navigate to /dashboard/events - see empty state or event list
2. Click "Add Event" - form renders with all fields
3. Submit form - event created, redirected to list, event appears
4. Click edit on event - form pre-filled with event data
5. Save changes - event updated in list
6. Delete event - confirmation, event removed from list
7. TypeScript compiles without errors
</verification>

<success_criteria>
- Events page shows all events for the couple's wedding
- Create event form captures all fields (name, datetime, location, address, dressCode, description, isPublic)
- Edit event pre-populates form with existing values
- Delete event removes it (with confirmation)
- Events display in chronological order
- Tenant isolation prevents accessing other couples' events
- UI follows established Tailwind styling patterns
</success_criteria>

<output>
After completion, create `.planning/phases/04-event-guest-management/04-02-SUMMARY.md`
</output>
